- name: "{{ test_name }}"
  shell: ptf --test-dir saitests {{ test_path }} --platform remote -t "router_mac='{{ ansible_Ethernet0['macaddress'] }}';server='{{ ansible_host }}';port_map_file='/root/{{ ptf_portmap | basename }}';{{ test_params }}" --disable-ipv6 --disable-vxlan --disable-geneve --disable-erspan --disable-mpls --disable-nvgre {{ extra_options | default("")}} 2>&1
  args:
    chdir: /root
  delegate_to: "{{ ptf_host }}"
  failed_when: False
  register: out

- debug: var=out.stdout_lines
  when: out.rc != 0

- fail: msg="Failed test '{{ test_name }}'"
  when: out.rc != 0
